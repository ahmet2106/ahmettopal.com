---
import { getCollection } from "astro:content";
import Posts from "@layouts/Posts.astro";
import getSortedPosts from "@utils/getSortedPosts";
import getPageNumbers from "@utils/getPageNumbers";
import getPagination from "@utils/getPagination";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const sortedPosts = await getSortedPosts(posts);

  return getPageNumbers(sortedPosts.length)
    .filter(page => page > 1)
    .map(page => ({ params: { page: String(page) } }));
}

const { page } = Astro.params;

const posts = await getCollection("blog");
const sortedPosts = await getSortedPosts(posts);

const pagination = getPagination({
  posts: sortedPosts,
  page,
});
---

<Posts {...pagination} />
